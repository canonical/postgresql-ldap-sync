# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.
name: Release

on:
  workflow_dispatch:

jobs:
  release:
    name: "Create a GitHub release"
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: "Install poetry"
        run: pipx install poetry
      - name: "Export package information"
        run: |
          VERSION=$(poetry version --short)
          if [ "$(git tag -l "${VERSION}")" ]; then
            echo "Tag ${VERSION} already exists. Please bump the project to a greater version."
            exit 1
          fi
          echo "VERSION=$VERSION" >> "$GITHUB_ENV"
      - name: "Create GitHub release"
        run: |
          git tag "${{ env.VERSION }}"
          git push origin "${{ env.VERSION }}"
          gh release create "${{ env.VERSION }}" --generate-notes --title "${{ env.VERSION }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
